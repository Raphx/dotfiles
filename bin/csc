#!/usr/bin/env bash

# Upgrade outdated Cask
brew cask ls | xargs brew cask info | grep '^http' -A1 -B1 | gawk '
BEGIN { 
  print("\033[34m==> \033[1;30mUpdating Casks\033[0m");
  RS = "--\n--\n";
  count = 0;
}
{
  cask_name = substr($1, 1, length($1) - 1);
  split($4, array, "/"); 

  if ($2 == "latest") {
    printf("\033[33m!!\033[0m ");
    printf("%s is versioned as latest.\n", cask_name);
  }
  else if ($2 != array[6]) {
    printf("\033[1;32mâœ“\033[0m ");
    printf("%s current (%s), update (%s)\n", $1, array[6], $2);
    count += 1;
    upgrades[cask_name] = 1;
  }
}
END {
  for (upgrade in upgrades)
    system("brew cask reinstall " upgrade);

  print count " cask(s) updated";
}'
