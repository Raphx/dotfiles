#!/usr/bin/env bash

usage="
Vim plugin management using Git sources.

Usage:

  $(basename "$0") [options] <subcommand>

Subcommands:

  i <url>     Install a plugin via a Git SSH or HTTPS URL

  u <name>    Remove an installed plugin using project name.
              Example https://github.com/foo/bar, 'bar' is
              the project name.

  l           List all installed plugins

Options:

  -h    Show this help message"

vimdir="$HOME/.local/share/vim/pack/plugins"

_install () {
  local url="$1"
  local name
  name=$(basename "$url")
  name=${name%.git}

  git -C "$vimdir" submodule add "$url" "start/$name"
}

_uninstall () {
  local name="$1"

  git -C "$vimdir" submodule deinit -f "$vimdir/start/$name"
  git -C "$vimdir" rm -rf "$vimdir/start/$name"
  rm -rf "$vimdir/.git/modules/start/$name"
}

_list () {
  git -C "$vimdir" submodule
}

if [ $# -eq 0 ]
then
  echo "$usage"
  exit 1
fi

for arg in "$@"
do
case $arg in
i)
  shift
  [ -z "$1" ] && echo "$usage" && exit 1
  _install "$1"
  exit 0
  ;;
u)
  shift
  [ -z "$1" ] && echo "$usage" && exit 1
  _uninstall "$1"
  exit 0
  ;;
l)
  _list
  exit 0
  ;;
-h)
  echo "$usage"
  exit 0
  ;;
*)
  echo "$usage"
  exit 1
  ;;
esac
done
